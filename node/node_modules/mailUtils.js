module.exports = {

    initialize: function() {
        var nodemailer = require("nodemailer");

        // create reusable transport method (opens pool of SMTP connections)
        var smtpTransport = nodemailer.createTransport("SMTP",{
            service: "Gmail",
            auth: {
                user: "goalglance@gmail.com",
                pass: "goalglancepassword"
            }
        });    
        module.exports.smtpTransport = smtpTransport;
    }, 

    sendMail: function(to,subject,bodyhtml,callback) {
        var mailOptions = {
            from: "GoalGlance <goalglance@gmail.com>", // sender address
            to: to, // list of receivers
            subject: subject, // Subject line            
            html: bodyhtml // html body
        };
        if (typeof callback !== 'undefined') {
            module.exports.smtpTransport.sendMail(mailOptions, callback);
        }
        else {
            module.exports.smtpTransport.sendMail(mailOptions, function(error, response){
                if(error){
                    console.log(error);
                }else{
                    console.log("Message sent: " + response.message);
                }            
            });    
        }
    },

    sendMailWithImage: function(to,subject,bodyhtml,imagename,imagedata,callback) {      
        var indexb64 = imagedata.indexOf('base64');
        if (indexb64 == -1) {
            console.log('error in image formatting, not sharing');
            return;
        }
        indexb64 += 7;
        var mailOptions = {
            from: "GoalGlance <goalglance@gmail.com>", // sender address
            to: to, // list of receivers
            subject: subject, // Subject line            
            html: bodyhtml, // html body
            attachments:[
              {
                fileName: imagename,
                contents: new Buffer(imagedata.substring(indexb64), 'base64'),
                cid: 'image'
              }
            ]
        };
        if (typeof callback !== 'undefined') {
            module.exports.smtpTransport.sendMail(mailOptions, callback);
        }
        else {
            module.exports.smtpTransport.sendMail(mailOptions, function(error, response){
                if(error){
                    console.log(error);
                }else{
                    console.log("Message sent: " + response.message);
                }            
            });    
        }
    }
}

