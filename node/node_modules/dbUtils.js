module.exports = {
    
    initialize: function(callback) {
        var host = require('os').hostname();
        var MongoClient = require('mongodb').MongoClient, format = require('util').format;


        MongoClient.connect('mongodb://' + host + ':27017/goalglance', function(err, db) {
            if(err) return next(err);
            module.exports.db = db;
            callback();
        });
    },

    createUser: function(username, email, password) {

            var collection = module.exports.db.collection('users');
            collection.insert({'username': username,
                               'email': email,
                               'password': password}, function(err) {if(err) throw err;});
            // this.checkUser(username, password);
            // needs to check if user exists and re-validate before adding

    },

    changePassword: function(username, email, newPassword) {
        var collection = module.exports.db.collection('users');
        collection.update(
            {
                'username': username,
                'email': email
            },
            {
                'username': username,
                'email': email,
                'password': newPassword

            }, function(err) {
                if (err) throw err;
            });
    },

    setGoal: function(username, newGoal) {
        // if user has a goal, need to delete it and all associated photos
    },

    checkUser: function(username, password, successCb, failureCb) {
        // Locate all the entries using find
            var collection = module.exports.db.collection('users');
            collection.find({'username': username,
                             'password': password}).toArray(function(err, results) {

                if (results.length) {
                    successCb();
                } else {
                    failureCb();
                }
            });
    },

    // this should take photo data and upload it to aws, then store that link
    // but for now, will just store link
    addPhoto: function(username, photoURL, addedBy) {
        var collection = module.exports.db.collection('users');
        var curDate = new Date();
    }
}